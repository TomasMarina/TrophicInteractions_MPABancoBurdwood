---
title: "The complex network of trophic interactions in a subAntarctic Marine Protected Area"
author: "Tomás I. Marina, Irene R. Schloss and Luciana Riccialdelli"
output: pdf_document
bibliography: "AMPBancoBurdwood.bib"
header-includes:
  - \usepackage[left]{lineno}
  - \linenumbers
---

```{r setup, include=FALSE, echo=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

library(knitr)
library(tidyverse)
library(pander)
library(ggplot2)
library(kableExtra)
library(multiweb)
library(ggjoy)
library(ggpubr)
library(igraph)
library(gridExtra)
library(grid)

```

## Abstract

\newpage

## Introduction

Brief description and ecological importance of MPAN-BB

The objective of the present work was twofold: characterize the network of trophic interactions in terms of complexity and structure for the MPA Namuncurá-Banco Burdwood ecosystem, and describe the species' role in such network framework.

\newpage

## Methodology

### Study area

The MPA Namuncurá-Banco Burdwood is a shallow submarine plateau called Burdwood Bank (BB) located 150 km east of Isla de los Estados and 200 km south from Malvinas/Falkland Islands (Figure 1). It comprises nearly 34.000 km^2 circumscribed by the 200 m isobath, between 54º–55ºS and 56º–62ºW, with a slight slope extended nearly 370 km east–west. The BB is surrounded by steep flanks of more than 3000 m depth through which strong currents circulate [@Piola1989; @Reta2014; @Matano2019]. Intense upwelling and mixing occur over it, entraining deep nutrient rich waters into the photic layer [@Piola2009; @Matano2019], and resulting in a fairly homogeneous water column both spatially and temporally [@Glorioso1995; @Guerrero1999; @Matano2019]. Physical features in the MPAN-BB are fairly stable, with salinity averaging 34 all year round and temperature ranging between 4 and 8ºC overall [@Guerrero1999; @Acha2004; @Piola2009].

```{r figure1, echo=FALSE}
# Map of MPAN-BB provided by Lu R. (?)

```


### Network construction

In order to build the network of predator-prey interactions we reviewed more than 150 references considering published articles, databases and doctoral theses. Furthermore, we took into account personal communications from experts belonging to the working group of the study area (https://www.pampazul.gob.ar/tag/banco-burdwood/). The diversity of the expertise of the authors contributing to the present study was a key factor in generating the quality of the network, and inherently improved the network representation of the MPA Namuncurá-Banco Burdwood ecosystem. A list of the bibliography used to build the network is presented in Supplementary Material (Table S1).

Due to a lack of trophic data resolution for some species inhabiting the MPA Namuncurá-Banco Burdwood, we follow the concept of trophic species, here defined as aggregated groups of taxa. In most cases we followed this when data on specific biological species were not available, but for some cases we collapsed species when taxa shared the same set of predators and prey (trophic similarity criteria). Details about this can be found in Supplementary Material (Table S2).

With the gathered trophic data we constructed an interaction matrix of pairwise interactions; a value of 1 or 0 was assigned to each element a_ij of the matrix depending on whether the j-species preyed or not on the i-species. Then we transformed such matrix into an oriented graph with L trophic interactions between S nodes or species. The orientation or direction of the graph follows the flow of energy and matter in the network, from prey to predator.

### Network analysis

We analyzed the MPA Namuncurá-Banco Burdwood network of trophic interactions, hereafter food web, at two levels: 1) global, considering species and interactions of the whole network; and 2) species, considering interactions and species related to a particular species.
For the global-level analysis we calculated several network properties commonly used to describe the complexity and structure in food webs [@Pascual2005]: (1) number of species S; (2) number of interactions or links L; (3) link density L/S; (4) Connectance L/S^2; (5) omnivory Omn; and (6) shortest path length SPL. Also, we estimated the (7) degree distributions for the food web, for prey and predators, and for each functional group (e.g. Amphipoda, Ascidiacea, Bivalvia, Fish, Marine mammals, Seabirds, etc.) (Table 1). The prey and predator distributions indicate the frequency of prey among predators, and viceversa; the functional group's degree shows the distribution of interactions within groups.
For the species-level analysis we considered the following properties: (1) betweenness Btw; (2) closeness Cl; (3) trophic level TL; (4) trophic similarity TS; and (5) topological role TR (Table 1). These properties provide a general appropriate description of species' role in empirical complex food webs [@Cirtwill2018].

All network analyses and graphs were performed in R version 4.2.2 [@RCoreTeam2022], mainly using 'igraph' [@Csardi2006] and ‘multiweb’ [@Saravia2022a] packages. The source code and data are available at https://github.com/TomasMarina/Banco-Burdwood.

```{r table1, echo=FALSE, results='asis'}

# Table 1. Network metrics
table1 <- tibble(Name="Number of species", Definition="Number of trophic species in a food web.", Implications="It represents the species diversity and has implications for the persistence of the ecosystem.", Reference = "May 1973, Tilman 1996")

table1 <- add_row(table1, Name="Number of interactions", Definition="Total number of trophic interactions in a food web.", Implications="It represents the number of pathways along which matter and energy can flow.", Reference="Dunne et al. 2002")

table1 <- add_row(table1, Name="Link density", Definition="Ratio of interactions to species in a food web", Implications="It represents the average number of interactions per species; informs about how connected species are in the food-web.", Reference="Dunne et al. 2002")

table1 <- add_row(table1, Name="Connectance", Definition="Proportion of potential links among species that are actually realized.", Implications="It measures the probability of interactions; it is a fundamental measure of network complexity. Connectance can be negatively or positively associated with food web robustness, depending on the network structure (random vs non-random) or how the strength of the interactions are distributed.", Reference = "Martinez 1991")

table1 <- add_row(table1, Name="Degree distribution", Definition="Probability of trophic species P(k) that have k or more interactions (both predator and prey links).", Implications="It suggests on the vulnerability of complex food webs against random failures and intentional attacks (i.e. species extinctions).", Reference="Albert & Barabási 2002")

table1 <- add_row(table1, Name="Omnivory", Definition="Species feeding on prey from more than one trophic level.", Implications="It influences food web's stability; intermediate levels of omnivory may stabilize it and may diffuse top-down effects thus reduce the probability of trophic cascades.", Reference = "McCann & Hastings 1997")

table1 <- add_row(table1, Name="Shortest path length", Definition="Average shortest path length between all pairs of species.", Implications="A short path length imply a rapid spread of an impact (e.g. invasion, population fluctuation, local extinction) throughout the food web.", Reference="Watts & Strogatz 1998")

table1 <- add_row(table1, Name="Betweenness", Definition="Number of shortest paths going through a species.", Implications=" Species with high betweenness act as “bridges”; if removed, would have rapidly spreading effects in the food web.", Reference="Freeman 1979")

table1 <- add_row(table1, Name="Closeness", Definition="Number of steps required to reach every other species from a given species.", Implications="The removal of a species with high closeness will affect the most other species in the food web.", Reference="Freeman 1979")

tabble1 <- add_row(table1, Name="Trophic level", Definition="It represents the number of interactions that separates a species from the base of the food web.", Implications="It indicates the position the species occupies in the food web; commonly categorized as producer, intermediate consumer and top predator.", Reference="Borelli & Ginzburg 2014")

table1 <- add_row(table1, Name="Trophic similarity", Definition="Trophic overlap based on shared and unique resources (prey) and consumers (predators).", Implications="It measures one of the most important aspects of species’ niches, the trophic niche, and functional aspects of biodiversity.", Reference="Martinez 1991")

table1 <- add_row(table1, Name="Topological role", Definition="Species role according to interactions within and across modules (subgroups of species).", Implications="Four roles are defined: module hub, module specialist, module connector and network connector. Species with the same role are expected to have similar topological properties.", Reference="Guimera 2005")

pandoc.table(table1, digits = 4, colnames("Property","Definition","Implication","Reference"), style="multiline", split.tables = Inf, justify = c('left','left','left','right'),
             caption = "List of network properties analyzed, definitions, and relevant ecological implications related to food web complexity and structure.")


```

\newpage

## Results

### Network-level properties

In terms of complexity, the MPA Namuncurá-Banco Burdwood food web consisted of 379 species and 1778 predator-prey interactions (Figure 2). The food web presents a link density of 4.69, meaning the average number of interactions per species, and a connectance of 0.01 (Table 1). Almost half of the consumers are omnivores, feeding on sources of different trophic levels. The food web shows a path length of 2.99, which implies that nearly three interactions are needed to connect any pair of species of the network.

```{r figure2, echo=FALSE, fig.align='center', fig.width = 20, fig.height=20, fig.cap="Graph of the food web of MPA Namuncurá-Banco Burdwood. Circles represent the species and arrows the trophic interactions. Colour gradient indicate the trophic level. Circle diameter is relative to the number of interactions."}
# Food web graph

load("../results/summary_results_jan23.rda")

par(cex.axis=1.5, cex.lab=1.5)
plot <- plot_troph_level(g, vertexLabel = F, modules = F, ylab = "Trophic level")

```

```{r table2, echo=FALSE}

load("../results/summary_results_jan23.rda")

knitr::kable(round(prop_topol,2) %>% dplyr::select(Size, Links, LD, Connectance, Omnivory, PathLength), col.names = c("Species","Interactions","Density","Connectance","Omnivory","Path length"),
                      caption = "Global-level properties of the food web of MPA Namuncurá-Banco Burdwood. See table 1 for definitions and ecological relevance.")

```

The degree distribution of the food web shows an asymmetric frequency in the number of interactions, where most of the species have relatively low interactions and few species concentrate the majority of them (Figure 2A). If we consider the distribution of prey among predators, most of the consumers feed on a low number of prey whereas few of them have multiple preys (Figure 2B). These are the top-five predators in number of prey: *Patagonotothen guntheri* (Notothenioid fish, 52 prey), *Patagonotothen ramsayi* (Notothenioid fish, 50 prey), *Dissostichus eleginoides* (Notothenioid fish, 30 prey), *Bathyraja brachyurops* (Chondrichthyan, 30 prey), and *Bathyraja griseocauda* (Chondrichthyan, 28 prey). Following the same distribution pattern, few prey are fed by multiple predators (Figure 2C). These are the top-five prey in number of predators:...
Finally, if we take into account the interactions within each functional group, the situation is the same as in the whole food web (Figure 2D). Overall, there is an evident asymmetry in the distribution of interactions among species in the MPA Namuncurá-Banco Burdwood food web.

Most Functional groups show an asymmetric distribution of interactions: few species are relatively more connected than the rest.
Most consumers have a narrow potential diet, few have a broad diet.
Few prey are consumed by many predators, most prey have few predators.
Consumers w/ broad diet: Patagonotothen guntheri, P. ramsayi, Dissostichus eleginoides, Bathyraja brachyurops, B. griseocauda.
Prey w/ many predators: Detritus, Diatoms (benthic, centric, pennate), Euphausia spp., Foraminifera.

\newpage

```{r figure3, echo=FALSE, fig.height = 28, fig.width = 20, fig.cap="Degree distributions for the (A) food web, for (B) prey among predators, (C) predators among prey, and (D) for each functional group. Groups are vertically ordered by trophic level."}
# Degree distributions: network, predator, prey & group
# above row (network, prey, predator), below row (group)

load("../data/foodweb-data_jan23.rda")
load("../results/summary_results_jan23.rda")

# Network Degree
degree <- as.data.frame(degree(g, mode = "total"))
plot_totdeg <- ggplot(degree, aes(degree[,1])) +
    geom_histogram(bins = 100, alpha = 0.3, color = "black") +
    labs(x = "Number of interactions (Degree)", y = "Frequency") +
    theme_bw() +
    theme(legend.position = "none",
          axis.text.x = element_text(size = 26),
          axis.text.y = element_text(size = 26),
          axis.title.x = element_text(face = "bold", size = 26),
          axis.title.y = element_text(face = "bold", size = 26))

# Predator Degree
# Generality (generalistas vs especialistas)
plot_preddeg <- spp_total %>% 
    filter(NumPrey != 0) %>% 
    ggplot(., aes(x = NumPrey)) +
    geom_histogram(stat = "count") +
    labs(x = "Predators", y = "Number of prey") +
    theme_bw() +
    theme(legend.position = "none",
          axis.text.x = element_text(size = 26),
          axis.text.y = element_text(size = 26),
          axis.title.x = element_text(face = "bold", size = 26),
          axis.title.y = element_text(face = "bold", size = 26)) #+
# annotate("text", x = Inf, y = Inf, label = paste("Prey per predator = ", round(prop_topol$Generality, 2), sep = ""),
#          size = 5, vjust=1, hjust=1))

# Prey Degree
# Vulnerability (energy flows)
plot_preydeg <- spp_total %>% 
    filter(NumPred != 0) %>% 
    ggplot(., aes(x = NumPred)) +
    geom_histogram(stat = "count") +
    labs(x = "Prey", y = "Number of predators") +
    theme_bw() +
    theme(legend.position = "none",
          axis.text.x = element_text(size = 26),
          axis.text.y = element_text(size = 26),
          axis.title.x = element_text(face = "bold", size = 26),
          axis.title.y = element_text(face = "bold", size = 26)) #+
# annotate("text", x = Inf, y = Inf, label = paste("Predators per prey = ", round(prop_topol$Vulnerability, 2), sep = ""),
#          size = 5, vjust=1, hjust=1))

# Group Degree
un.prey <- as.data.frame(unique(int_good_res$PreyGroup))  # prey groups
un.pred <- as.data.frame(unique(int_good_res$PredGroup))  # pred groups
colnames(un.prey) <- "Group"
colnames(un.pred) <- "Group"
unique_FG <- unique(bind_rows(un.pred, un.prey))  # 35 groups

col_palette <- scales::hue_pal()(nrow(unique_FG))
FGColors <- setNames(col_palette, levels(unique_FG$Group))
unique_FG <- cbind(unique_FG, as.data.frame(FGColors))
colnames(unique_FG) <- c("FunctionalGroup", "FGColor")

plot_grpdeg <- spp_total %>% 
    add_count(FunctionalGroup) %>% 
    filter(n > 2) %>% 
    group_by(FunctionalGroup) %>% 
    mutate(TL_fg = mean(TL)) %>% 
    ggplot(., aes(x = TotalDegree, y = reorder(FunctionalGroup, TL_fg), fill = FunctionalGroup)) + 
    geom_joy(scale = 3.75) +
    scale_fill_manual(values = FGColors) +
    labs(x = "Number of interactions", y = "Functional group", tag="D") +
    theme_joy(grid = FALSE) +
    theme(legend.position = "none",
          axis.text.x = element_text(size = 26),
          axis.text.y = element_text(size = 20),
          axis.title.x = element_text(face = "bold", size = 26),
          axis.title.y = element_text(face = "bold", size = 26),
          plot.tag = element_text(face = "bold", size = 32),
          plot.tag.position = c(0.05, 1))

# Arrange figure
a <- plot_totdeg
b <- plot_preddeg
c <- plot_preydeg
d <- plot_grpdeg

# Move to a new page
grid.newpage()
# Nested ggarrange
figure_3 <- ggarrange(a,                                                                                         # First row
          ggarrange(b, c, ncol = 2, labels = c("B", "C"), font.label=list(color="black",size=30)),   # Second row
          ggarrange(d, ncol = 1),                                                                    # Third row
          nrow = 3, labels = "A",
          font.label=list(color="black",size=30))
figure_3

# # Create layout : nrow = 2, ncol = 2
# pushViewport(viewport(layout = grid.layout(3, 2)))
# # A helper function to define a region on the layout
# define_region <- function(row, col){
#   viewport(layout.pos.row = row, layout.pos.col = col)
# } 
# # Arrange the plots
# print(a, vp = define_region(1, 1:2))
# print(b, vp = define_region(2, 1))
# print(c, vp = define_region(2, 2))
# print(d, vp = define_region(3, 1:2))

```


### Species-level properties

The majority of the species of the food web are consumers, 336 out of 379; the rest are primary producers, such as phytoplankton, and non-living food sources like detritus and necromass.

\newpage

```{r figure4, echo=FALSE, fig.width = 20, fig.height=20, fig.cap="Species-level properties (A) betwenness, (B) closeness, and (C) trophic similarity by trophic level (equal or greater than 2). See table 1 for definitions and ecological relevance."}
# Betweenness, Closeness & Trophic similarity by Trophic level (>= 2)

# Betweenness
plot_sp_bt <- spp_total %>% 
  filter(TL >= 2) %>% 
  ggplot(., aes(x = TL, y = Between)) +
  geom_point() +
  #geom_vline(xintercept = c(spp_nt_12+1, spp_nt_12+spp_nt_13+1, spp_nt_14+1), linetype = "longdash", colour = "red") +
  labs(x = "Trophic level", y = "Betweenness") +
  theme_bw() +
  theme(panel.grid = element_blank(),
        axis.text.x = element_text(size = 26),
        axis.text.y = element_text(size = 26),
        axis.title = element_text(size = 26, face = "bold"))

# Closeness
plot_sp_cl <- spp_total %>% 
  filter(TL >= 2) %>%
  ggplot(., aes(x = TL, y = Close)) +
  geom_point() +
  #geom_vline(xintercept = c(spp_nt_12+1, spp_nt_12+spp_nt_13+1, spp_nt_14+1), linetype = "longdash", colour = "red") +
  labs(x = "Trophic level", y = "Closeness") +
  theme_bw() +
  theme(panel.grid = element_blank(),
        axis.text.x = element_text(size = 26),
        axis.text.y = element_text(size = 26),
        axis.title = element_text(size = 26, face = "bold"))

# Trophic similarity
plot_sp_ts <- spp_total %>% 
  filter(TL >= 2) %>%
  ggplot(., aes(x = TL, y = meanTrophicSimil)) +
  geom_point() +
  #geom_vline(xintercept = c(spp_nt_12+1, spp_nt_12+spp_nt_13+1, spp_nt_14+1), linetype = "longdash", colour = "red") +
  labs(x = "Trophic level", y = "Trophic similarity") +
  theme_bw() +
  theme(panel.grid = element_blank(),
        axis.text.x = element_text(size = 26),
        axis.text.y = element_text(size = 26),
        axis.title = element_text(size = 26, face = "bold"))

# Move to a new page
grid.newpage()
# Arrange figure
figure_4 <- ggarrange(plot_sp_bt + rremove("xlab"), plot_sp_cl + rremove("xlab"), plot_sp_ts + rremove("xlab"),
                      labels = c("A","B","C"), ncol=2, nrow=2,
                      font.label = list(size = 30, color = "black"))
annotate_figure(figure_4, bottom = textGrob("Trophic level", gp = gpar(fontface="bold", col="black", fontsize=26)))

```


‘Network connector’ and ‘module connector’ species are responsible for linking modules and maintaining the connectivity of the food web. TL range for these species: 1 - 3.86.

Betweenness = Species at mid-trophic levels (3-4) present more shortest paths between species than any other species: ‘bridge’ role.
Closeness = Low-trophic level species are relatively closer to other species in the food web.

Trophic similarity: Species are more similar at mid-trophic levels (2-3) than in lower or higher ones. Basal and top species present a higher uniqueness in terms of trophic role.

## Discussion

### The MPA Namuncurá-Banco Burdwood food web

### Species' role

The distribution of the interactions is asymmetric, where few species concentrate most of the interactions: Detritus, Diatoms (x3), Patagonotothen ramsayi & P. guntheri, Euphausia spp. The same happens within each functional group.

The most demanded food sources are: Detritus, Diatoms (x3), Euphausia spp., & Foraminifera.
Almost half of the consumers (47.64 %) are omnivores. Those with the broadest diets are: Patagonotothen ramsayi, P. guntheri, Dissostichus eleginoides, Bathyraja brachyurops, B. griseocauda.

Low and mid-trophic level species are responsible for maintaining the connectivity of the food web. The functional groups represented are: Amphipoda, Bivalvia, Bryozoa, Cnidaria, Cumacea, Decapoda, Detritus, Diatoms, Echinodermata, Fish (bentho-pelagic, demersal, chondrichthyes), Foraminifera, Polychaeta, Porifera, Zooplankton.

Low and mid-trophic level species present the highest betweenness and closeness values. These species have an important ‘bridge’ role and are close to other species.
Mid-trophic level species are more redundant than those at low and high trophic levels.

### Caveats and future perspectives

\newpage

## References